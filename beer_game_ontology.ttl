# ============================================================
# BEER DISTRIBUTION GAME - SHARED ONTOLOGY (FIXED)
# Based on HBR "When Supply Chains Become Autonomous" (Dec 2024)
# FIXED: Temporal entity inference issues
# ============================================================

@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix swrl: <http://www.w3.org/2003/11/swrl#> .
@prefix swrlb: <http://www.w3.org/2003/11/swrlb#> .

# Common beer game ontology
@prefix bg: <http://beergame.org/ontology#> .
@prefix bg_retailer: <http://beergame.org/retailer#> .
@prefix bg_wholesaler: <http://beergame.org/wholesaler#> .
@prefix bg_distributor: <http://beergame.org/distributor#> .
@prefix bg_factory: <http://beergame.org/factory#> .

# ============================================================
# TEMPORAL MODEL FOUNDATION
# ============================================================

# Abstract class for all temporal entities
bg:TemporalEntity a owl:Class ;
    rdfs:label "Temporal Entity" ;
    rdfs:comment "Any entity anchored to a specific week in the simulation" .

# Time dimension
bg:Week a owl:Class ;
    rdfs:label "Week" ;
    rdfs:comment "Discrete time period in the supply chain simulation" .

bg:previousWeek a owl:ObjectProperty ;
    rdfs:domain bg:Week ;
    rdfs:range bg:Week ;
    rdfs:label "previous week" ;
    rdfs:comment "Links a week to its immediate predecessor" .

bg:weekNumber a owl:DatatypeProperty ;
    rdfs:domain bg:Week ;
    rdfs:range xsd:integer ;
    rdfs:label "week number" .

# Temporal relationships (FIXED: No restrictive domain)
bg:forWeek a owl:ObjectProperty ;
    rdfs:domain bg:TemporalEntity ;
    rdfs:range bg:Week ;
    rdfs:label "for week" ;
    rdfs:comment "Associates any temporal entity with a specific week" .

bg:belongsTo a owl:ObjectProperty ;
    rdfs:domain bg:TemporalEntity ;
    rdfs:range bg:Actor ;
    rdfs:label "belongs to actor" ;
    rdfs:comment "Indicates which actor a temporal entity belongs to" .

# ============================================================
# CORE ACTOR CLASSES
# ============================================================

bg:Actor a owl:Class ;
    rdfs:label "Supply Chain Actor" ;
    rdfs:comment "A participant in the beer distribution game" .

bg:Retailer a owl:Class ;
    rdfs:subClassOf bg:Actor ;
    rdfs:label "Retailer" ;
    rdfs:comment "Sells beer to end customers" .

bg:Wholesaler a owl:Class ;
    rdfs:subClassOf bg:Actor ;
    rdfs:label "Wholesaler" ;
    rdfs:comment "Distributes beer to retailers" .

bg:Distributor a owl:Class ;
    rdfs:subClassOf bg:Actor ;
    rdfs:label "Distributor" ;
    rdfs:comment "Distributes beer from factory to wholesalers" .

bg:Factory a owl:Class ;
    rdfs:subClassOf bg:Actor ;
    rdfs:label "Factory" ;
    rdfs:comment "Produces beer" .

# ============================================================
# TEMPORAL ENTITY CLASSES (All subclass TemporalEntity)
# ============================================================

bg:ActorMetrics a owl:Class ;
    rdfs:subClassOf bg:TemporalEntity ;
    rdfs:label "Actor Metrics" ;
    rdfs:comment "Performance metrics snapshot for an actor at a specific week" .

bg:Inventory a owl:Class ;
    rdfs:subClassOf bg:TemporalEntity ;
    rdfs:label "Inventory" ;
    rdfs:comment "Beer inventory state at an actor's position for a specific week" .

bg:Order a owl:Class ;
    rdfs:subClassOf bg:TemporalEntity ;
    rdfs:label "Order" ;
    rdfs:comment "A purchase order between actors placed in a specific week" .

bg:Shipment a owl:Class ;
    rdfs:subClassOf bg:TemporalEntity ;
    rdfs:label "Shipment" ;
    rdfs:comment "Beer units in transit, created in a specific week" .

bg:CustomerDemand a owl:Class ;
    rdfs:subClassOf bg:TemporalEntity ;
    rdfs:label "Customer Demand" ;
    rdfs:comment "End customer demand for beer in a specific week" .

bg:InternalMetrics a owl:Class ;
    rdfs:subClassOf bg:TemporalEntity ;
    rdfs:label "Internal Metrics" ;
    rdfs:comment "Private actor data for a specific week (non-federated)" .

# ============================================================
# ACTOR PROPERTIES (Static)
# ============================================================

# Actor relationships
bg:suppliesTo a owl:ObjectProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range bg:Actor ;
    rdfs:label "supplies to" ;
    rdfs:comment "Indicates supply relationship direction" .

bg:ordersFrom a owl:ObjectProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range bg:Actor ;
    rdfs:label "orders from" ;
    rdfs:comment "Indicates ordering relationship direction" .

# Actor metrics relationship
bg:hasMetrics a owl:ObjectProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range bg:ActorMetrics ;
    rdfs:label "has metrics" ;
    rdfs:comment "Links an actor to its metrics snapshots" .

# Delays (game parameters - static per actor)
bg:shippingDelay a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:integer ;
    rdfs:label "shipping delay" ;
    rdfs:comment "Weeks for shipment to arrive at downstream partner" .

bg:orderDelay a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:integer ;
    rdfs:label "order delay" ;
    rdfs:comment "Weeks for order to be processed by upstream partner" .

# Cost tracking (cumulative)
bg:totalCost a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:decimal ;
    rdfs:label "total cost" ;
    rdfs:comment "Cumulative cost (holding + backlog) across all weeks" .

# Guardrails and constraints
bg:budgetConstraint a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:decimal ;
    rdfs:label "budget constraint" ;
    rdfs:comment "Maximum spending allowed per week" .

# Agent metadata
bg:agentModel a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:string ;
    rdfs:label "agent model" ;
    rdfs:comment "GenAI model powering this actor (e.g., 'GPT-5', 'Claude-4')" .

bg:agentPrompt a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:string ;
    rdfs:label "agent prompt" ;
    rdfs:comment "System prompt for the AI agent" .

# ============================================================
# ACTOR METRICS PROPERTIES (Temporal)
# ============================================================

bg:demandRate a owl:DatatypeProperty ;
    rdfs:domain bg:ActorMetrics ;
    rdfs:range xsd:decimal ;
    rdfs:label "demand rate" ;
    rdfs:comment "Average demand per week (smoothed) for this week" .

bg:inventoryCoverage a owl:DatatypeProperty ;
    rdfs:domain bg:ActorMetrics ;
    rdfs:range xsd:decimal ;
    rdfs:label "inventory coverage" ;
    rdfs:comment "Weeks of inventory at current demand rate for this week" .

bg:suggestedOrderQuantity a owl:DatatypeProperty ;
    rdfs:domain bg:ActorMetrics ;
    rdfs:range xsd:integer ;
    rdfs:label "suggested order quantity" ;
    rdfs:comment "Recommended order quantity calculated by rules for this week" .

bg:hasBullwhipRisk a owl:DatatypeProperty ;
    rdfs:domain bg:ActorMetrics ;
    rdfs:range xsd:boolean ;
    rdfs:label "has bullwhip risk" ;
    rdfs:comment "Flag indicating potential bullwhip effect for this week" .

bg:hasStockoutRisk a owl:DatatypeProperty ;
    rdfs:domain bg:ActorMetrics ;
    rdfs:range xsd:boolean ;
    rdfs:label "has stockout risk" ;
    rdfs:comment "Flag indicating potential stockout for this week" .

bg:maxOrderQuantity a owl:DatatypeProperty ;
    rdfs:domain bg:ActorMetrics ;
    rdfs:range xsd:integer ;
    rdfs:label "max order quantity" ;
    rdfs:comment "Dynamic guardrail capping order size for this week" .

# ============================================================
# ORDER PROPERTIES
# ============================================================

bg:orderQuantity a owl:DatatypeProperty ;
    rdfs:domain bg:Order ;
    rdfs:range xsd:integer ;
    rdfs:label "order quantity" ;
    rdfs:comment "Number of units ordered (discrete)" .

bg:placedBy a owl:ObjectProperty ;
    rdfs:domain bg:Order ;
    rdfs:range bg:Actor ;
    rdfs:label "placed by" ;
    rdfs:comment "Actor who placed the order" .

bg:receivedBy a owl:ObjectProperty ;
    rdfs:domain bg:Order ;
    rdfs:range bg:Actor ;
    rdfs:label "received by" ;
    rdfs:comment "Actor who receives the order (upstream supplier)" .

bg:orderAmplification a owl:DatatypeProperty ;
    rdfs:domain bg:Order ;
    rdfs:range xsd:decimal ;
    rdfs:label "order amplification" ;
    rdfs:comment "Ratio of order quantity to actual demand (bullwhip indicator)" .

# ============================================================
# INVENTORY PROPERTIES
# ============================================================

bg:currentInventory a owl:DatatypeProperty ;
    rdfs:domain bg:Inventory ;
    rdfs:range xsd:integer ;
    rdfs:label "current inventory" ;
    rdfs:comment "Units currently in stock" .

bg:backlog a owl:DatatypeProperty ;
    rdfs:domain bg:Inventory ;
    rdfs:range xsd:integer ;
    rdfs:label "backlog" ;
    rdfs:comment "Unfulfilled orders (stockouts)" .

bg:incomingShipment a owl:DatatypeProperty ;
    rdfs:domain bg:Inventory ;
    rdfs:range xsd:integer ;
    rdfs:label "incoming shipment" ;
    rdfs:comment "Units arriving this week from upstream" .

bg:outgoingShipment a owl:DatatypeProperty ;
    rdfs:domain bg:Inventory ;
    rdfs:range xsd:integer ;
    rdfs:label "outgoing shipment" ;
    rdfs:comment "Units shipped to downstream this week" .

bg:holdingCost a owl:DatatypeProperty ;
    rdfs:domain bg:Inventory ;
    rdfs:range xsd:decimal ;
    rdfs:label "holding cost" ;
    rdfs:comment "Cost per unit in inventory per week" .

bg:backlogCost a owl:DatatypeProperty ;
    rdfs:domain bg:Inventory ;
    rdfs:range xsd:decimal ;
    rdfs:label "backlog cost" ;
    rdfs:comment "Penalty cost per unit backordered per week" .

# ============================================================
# SHIPMENT PROPERTIES
# ============================================================

bg:quantity a owl:DatatypeProperty ;
    rdfs:domain bg:Shipment ;
    rdfs:range xsd:integer ;
    rdfs:label "quantity" ;
    rdfs:comment "Number of units in shipment (discrete)" .

bg:shippedQuantity a owl:DatatypeProperty ;
    rdfs:domain bg:Shipment ;
    rdfs:range xsd:integer ;
    rdfs:label "shipped quantity" ;
    rdfs:comment "Alias for quantity (backwards compatibility)" .

bg:arrivalWeek a owl:ObjectProperty ;
    rdfs:domain bg:Shipment ;
    rdfs:range bg:Week ;
    rdfs:label "arrival week" ;
    rdfs:comment "Week when shipment arrives (IRI reference to bg:Week)" .

bg:shippedFrom a owl:ObjectProperty ;
    rdfs:domain bg:Shipment ;
    rdfs:range bg:Actor ;
    rdfs:label "shipped from" ;
    rdfs:comment "Actor who sent the shipment" .

bg:shippedTo a owl:ObjectProperty ;
    rdfs:domain bg:Shipment ;
    rdfs:range bg:Actor ;
    rdfs:label "shipped to" ;
    rdfs:comment "Actor who receives the shipment" .

# ============================================================
# CUSTOMER DEMAND PROPERTIES
# ============================================================

bg:actualDemand a owl:DatatypeProperty ;
    rdfs:domain bg:CustomerDemand ;
    rdfs:range xsd:integer ;
    rdfs:label "actual demand" ;
    rdfs:comment "Real end-customer demand (only retailer sees directly)" .

bg:demandPattern a owl:DatatypeProperty ;
    rdfs:domain bg:CustomerDemand ;
    rdfs:range xsd:string ;
    rdfs:label "demand pattern" ;
    rdfs:comment "Pattern type: stable, spike, increasing, random" .

# ============================================================
# INTERNAL METRICS PROPERTIES
# ============================================================

bg:retailMargin a owl:DatatypeProperty ;
    rdfs:domain bg:InternalMetrics ;
    rdfs:range xsd:decimal ;
    rdfs:label "retail margin" .

bg:customerSatisfactionScore a owl:DatatypeProperty ;
    rdfs:domain bg:InternalMetrics ;
    rdfs:range xsd:integer ;
    rdfs:label "customer satisfaction score" .

bg:internalNotes a owl:DatatypeProperty ;
    rdfs:domain bg:InternalMetrics ;
    rdfs:range xsd:string ;
    rdfs:label "internal notes" ;
    rdfs:comment "Private notes (non-federated)" .

# ============================================================
# GAME CONSTANTS
# ============================================================

bg:defaultHoldingCost a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:decimal ;
    owl:equivalentProperty [ rdf:value "0.50"^^xsd:decimal ] .

bg:defaultBacklogCost a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:decimal ;
    owl:equivalentProperty [ rdf:value "1.00"^^xsd:decimal ] .

bg:defaultShippingDelay a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:integer ;
    owl:equivalentProperty [ rdf:value "2"^^xsd:integer ] .

bg:defaultOrderDelay a owl:DatatypeProperty ;
    rdfs:domain bg:Actor ;
    rdfs:range xsd:integer ;
    owl:equivalentProperty [ rdf:value "1"^^xsd:integer ] .

# ============================================================
# DOCUMENTATION
# ============================================================

# This ontology uses a temporal model where:
# 1. Each week is a discrete time point (bg:Week)
# 2. All temporal entities (Inventory, Order, Shipment, etc.) 
#    are linked to a specific week via bg:forWeek
# 3. All temporal entities belong to an actor via bg:belongsTo
# 4. ActorMetrics provide calculated performance indicators per week
# 5. No temporal properties are attached directly to Actors
#    (they're all in temporal entities)
#
# This design enables:
# - Clear before/after comparisons for causal analysis
# - Easy reconstruction of system evolution over time
# - Natural modeling of delays and lag effects
# - Federated queries across multiple actors
# - State-based rather than event-based reasoning

# SWRL rules are defined separately in: beer-game-swrl-rules.ttl
# To use:
# 1. Import this ontology file first
# 2. Then import beer-game-swrl-rules.ttl (if using SWRL)
# 3. Or use SPARQL UPDATE rules in temporal_beer_game_rules.py
# 4. Enable reasoning in repository settings (RDFS+ or OWL-Horst)